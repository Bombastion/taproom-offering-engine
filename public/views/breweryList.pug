<link rel="stylesheet" type="text/css" href="/editor.css" />

script.
  function toggleShowElement(divId) {
    var element = document.querySelector(`#${divId}`);
    element.style.display = element.style.display === "none" ? "" : "none";
  }

script.
  function isFormTextValueValid(form, fieldName) {
    const value = form[fieldName].value;
    if (value == "") {
      alert(`${fieldName} must be filled out`);
      return false;
    }
    return true;
  }

  function setB64FormFieldFromImage(form) {
    const logoFileElement = form.newBreweryLogo;
    const files = logoFileElement.files;
    if (files && files.length > 0) {
      // Assume a single file
      const file = files[0];
      const reader = new FileReader();

      reader.onload = function (e) {
        // The result is a Data URL (e.g., "data:image/jpeg;base64,<the stuff we want as b64 data>")
        const dataURL = e.target.result;
        const base64String = dataURL.split(',')[1]; 

        const b64FormElement = form.newBreweryLogoB64;
        b64FormElement.value = base64String;
      };

      reader.readAsDataURL(file);
    }
  }

  function setItemIdFormField(itemId) {
    const formElement = document.getElementById('newItemIdHidden');
    formElement.value = itemId;
  }

  function stringifyForm(form) {
    const formData = new FormData(form);
    const formObject = Object.fromEntries(formData.entries());
    return JSON.stringify(formObject); 
  }

  function submitAddForm(formId) {
    const form = document.getElementById(formId);
    setB64FormFieldFromImage(form);
    if (!isFormTextValueValid(form, 'newBreweryName')) {
      return;
    }
    if (!isFormTextValueValid(form, 'newBreweryLocation')) {
      return;
    }
    if (!isFormTextValueValid(form, 'newBreweryLogoB64')) {
      return; 
    }

    const jsonString = stringifyForm(form);

    fetch(`/breweries`, {
      method:'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: jsonString
    }).then(data => {
      window.location.reload();
    })
    .catch(error => {
      alert(`Problem making request: ${error}`);
    });
  }

  function submitEditForm(formId, breweryId) {
    const form = document.getElementById(formId);
    setB64FormFieldFromImage(form);

    const jsonString = stringifyForm(form);

    fetch(`/breweries/${breweryId}`, {
      method:'PATCH',
      headers: {
        'Content-Type': 'application/json'
      },
      body: jsonString
    }).then(data => {
      window.location.reload();
    })
    .catch(error => {
      alert(`Problem making request: ${error}`);
    });
  }

html
  body
    table
      button(onclick="toggleShowElement('createBreweryDiv')") Add New
      div(style="display: none;", id="createBreweryDiv")
        form(action="/breweries?callbackUrl=/breweries/manage" method="POST" id="addBreweryForm")
          label(for="newBreweryName") Name:
          input(name="newBreweryName" id="newBreweryName")
          label(for="newBreweryLocation") Location:
          input(name="newBreweryLocation" id="newBreweryLocation")
          label(for="newBreweryLogo") Logo:
          input(name="newBreweryLogo" id="newBreweryLogo" type="file" accept="image/png, image/jpeg" onchange="setB64FormFieldFromImage(document.getElementById('addBreweryForm'))")
          input(name="newBreweryLogoB64" id="newBreweryLogoB64" type="hidden")
        button(onclick="submitAddForm('addBreweryForm')" type="button") Create Brewery
      tbody
        tr
          th Logo 
          th Name 
          th Location 
          th 
        each brewery in breweries
          - var name = brewery.name
          - var location = brewery.location
          - var breweryId = brewery.id
          tr 
            td 
              img(class='logo' src='data:image;base64, ' + brewery.defaultLogo)
            td #{name}
            td #{location}
            td
              button(onclick=`toggleShowElement('editBreweryElement${breweryId}')`) Edit
          tr(style="display: none;", id=`editBreweryElement${breweryId}`)
            form(action=`/breweries/${breweryId}?callbackUrl=/breweries/manage` id=`updateBreweryForm${breweryId}`)
              td
                label(for="newBreweryLogo") Logo:
                input(name="newBreweryLogo" id="newBreweryLogo" type="file" accept="image/png, image/jpeg" onchange=`setB64FormFieldFromImage(document.getElementById('updateBreweryForm${breweryId}'))`)
              td
                label(for="newBreweryName") Name:
                input(name="newBreweryName" id="newBreweryName")
              td
                label(for="newBreweryLocation") Location:
                input(name="newBreweryLocation" id="newBreweryLocation")
              input(name="newBreweryLogoB64" id="newBreweryLogoB64" type="hidden")
              td
                button(onclick=`submitEditForm('updateBreweryForm${breweryId}', '${breweryId}')` type="button") Update Brewery
